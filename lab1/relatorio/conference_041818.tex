\documentclass[conference]{IEEEtran}
\IEEEoverridecommandlockouts
% The preceding line is only needed to identify funding in the first footnote. If that is unneeded, please comment it out.
\usepackage{cite}
\usepackage{amsmath,amssymb,amsfonts}
\usepackage{algorithmic}
\usepackage{graphicx}
\usepackage{textcomp}
\usepackage{xcolor}
\usepackage[brazilian]{babel}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{listings}
\usepackage{color}

\definecolor{dkgreen}{rgb}{0,0.6,0}
\definecolor{gray}{rgb}{0.5,0.5,0.5}
\definecolor{mauve}{rgb}{0.58,0,0.82}

\lstset{frame=tb,
  language=Java,
  aboveskip=3mm,
  belowskip=3mm,
  showstringspaces=false,
  columns=flexible,
  basicstyle={\small\ttfamily},
  numbers=none,
  numberstyle=\tiny\color{gray},
  keywordstyle=\color{blue},
  commentstyle=\color{dkgreen},
  stringstyle=\color{mauve},
  breaklines=true,
  breakatwhitespace=true,
  tabsize=3
}
\lstset{language=Python}
\def\BibTeX{{\rm B\kern-.05em{\sc i\kern-.025em b}\kern-.08em
    T\kern-.1667em\lower.7ex\hbox{E}\kern-.125emX}}
\begin{document}

\title{Relatório do Laboratório 1: \\ Máquina de Estados Finita e Behavior Tree\\
}

\author{\IEEEauthorblockN{Isabelle Ferreira de Oliveira}
\IEEEauthorblockA{\textit{CT-213 - Engenharia da Computação 2020} \\
\textit{Instituto Tecnológico de Aeronáutica (ITA)}\\
São José dos Campos, Brasil \\
isabelle.ferreira3000@gmail.com}
}

\maketitle

\begin{abstract}
Esse relatório documenta a implementação do comportamento de um robô Roomba, um robô de limpeza desenvolvido pela empresa iRobot. O comportamento foi idealizado e simplificado em um simulador, cujo código base, com parte da implementação, já havia sido fornecido pelo professor. Para o restante da codificação, implementou-se máquina de estados finita e behavior tree. Por fim, os resultados das duas implementações foram comparados.
\end{abstract}

\begin{IEEEkeywords}
Roomba, máquina de estados, behavior tree
\end{IEEEkeywords}

\section{Introdução}
This document is a model and instructions for \LaTeX.
Please observe the conference page limits. 

\section{Implementação de Estados}
Na parte relativa a implementação da máquina de estados, era necessário preencher os códigos das funções \textit{check\underline{\space}transition} e \textit{execute}, além do construtor das classes \textit{MoveForwardState}, \textit{MoveInSpiralState}, \textit{GoBackState} e \textit{RotateState}.

Para calcular quanto tempo já está sendo executado um determinado estado, foi adicionado nos respectivos construtores um contador que era acrescido cada vez que era executado o comportamento desse estado. Assim, o tempo seria esse contador vezes o tempo gasto em cada execução, conforme sugerido no roteiro do laboratório \cite{b1}.

As transições em cada estado foram implementadas nas respectivas funções \textit{check\underline{\space}transition} de cada classe de estado, conforme o apresentado na Figura \ref{state_machine}, retirado do roteiro do laboratório \cite{b1}. A ideia de cada uma das implementações foi apresentada nas subseções abaixo, escritas em pseudo-Python.

\begin{figure}[htbp]
\centerline{\includegraphics[scale=0.4]{maquina_estados.png}}
\caption{Máquina de estados finita do comportamento do Roomba.}
\label{state_machine}
\end{figure}

Já as funções \textit{execute}, além de realizarem o acréscimo do contador de execuções, também eram responsáveis por atualizar as velocidades do Roomba, a fim de que ele realizasse os movimentos esperados para cada estado. A ideia de cada uma das implementações também foi apresentada nas subseções abaixo, escritas em pseudo-Python.

Uma breve descrição em alto nível das implementações foi apresentada nas subsessões a seguir.

\subsection{Estado Move Forward}
Verificação das transições da máquina de estados na função \textit{check\underline{\space}transition} para o estado \textit{Move Forward}:
\begin{lstlisting}
if COLIDIU COM A PAREDE:
	MUDAR PARA ESTADO "GO BACK"
elif TEMPO_NESSE_ESTADO > TEMPO_NO_MOVE_FORWARD:
	MUDAR PARA ESTADO "MOVE IN SPIRAL"
\end{lstlisting}

Atualização das velocidades do Roomba na função \textit{execute} para o estado \textit{Move Forward}:
\begin{lstlisting}
ROOMBA.set_velocity(VELOCIDADE_LINEAR = FORWARD_SPEED, VELOCIDADE_ANGULAR = 0)
\end{lstlisting}

\subsection{Estado Move In Spiral}
Verificação das transições da máquina de estados na função \textit{check\underline{\space}transition} para o estado \textit{Move in Spiral}:
\begin{lstlisting}
if COLIDIU COM A PAREDE:
	MUDAR PARA ESTADO "GO BACK"
elif TEMPO_NESSE_ESTADO > TEMPO_NO_MOVE_IN_SPIRAL:
	MUDAR PARA ESTADO "MOVE FORWARD"
\end{lstlisting}

Atualização das velocidades do Roomba na função \textit{execute} para o estado \textit{Move In Spiral}:
\begin{lstlisting}
ROOMBA.set_velocity(VELOCIDADE_LINEAR = FORWARD_SPEED, VELOCIDADE_ANGULAR = FORWARD_SPEED/(INITIAL_RADIUS_SPIRAL + SPIRAL_FACTOR * TEMPO)
\end{lstlisting}

O cálculo dessa velocidade angular foi feito tendo em vista que o raio da espiral varia conforme a equação $r(t) = r_0 + b \cdot t$, onde $r_0$ é o raio inicial do espiral e $b$ é o fator do espiral, e que velocidade angular é velocidade linear dividido pelo raio da curva no instante.

\subsection{Estado Go Back}
Verificação das transições da máquina de estados na função \textit{check\underline{\space}transition} para o estado \textit{Go Back}:
\begin{lstlisting}
if TEMPO_NESSE_ESTADO > TEMPO_NO_GO_BACK:
	MUDAR PARA ESTADO "ROTATE"
\end{lstlisting}

Atualização das velocidades do Roomba na função \textit{execute} para o estado \textit{Go Back}:
\begin{lstlisting}
ROOMBA.set_velocity(VELOCIDADE_LINEAR = BACKWARD_SPEED, VELOCIDADE_ANGULAR = 0)
\end{lstlisting}

\subsection{Estado Rotate}
Verificação das transições da máquina de estados na função \textit{check\underline{\space}transition} para o estado \textit{Rotate}:
\begin{lstlisting}
if TEMPO_NESSE_ESTADO > TEMPO_NO_ROTATE:
	MUDAR PARA ESTADO "MOVE FORWARD"
\end{lstlisting}

O tempo que o Roomba passa no estado Rotate é calculado da seguinte maneira: um ângulo aleatório é escolhido entre $-\pi$ e $\pi$ para que ele faça a rotação e, dado a velocidade angular pré-estabelecida empregada nesse movimento, o tempo será o módulo desse ângulo dividido por essa velocidade.

Atualização das velocidades do Roomba na função \textit{execute} para o estado \textit{Go Back}:
\begin{lstlisting}
if ANGULO EH NEGATIVO:
	ROOMBA.set_velocity(VELOCIDADE_LINEAR = 0, VELOCIDADE_ANGULAR = -ANGULAR_SPEED)
else:
	ROOMBA.set_velocity(VELOCIDADE_LINEAR = 0, VELOCIDADE_ANGULAR = ANGULAR_SPEED)
\end{lstlisting}

\section{Implementação de Behaviors}
Já na parte relativa a implementação da Behavior Tree, era necessário preencher os códigos das funções \textit{enter} e \textit{execute}, além do construtor das classes \textit{RoombaBehaviorTree}, \textit{MoveForwardNode}, \textit{MoveInSpiralNode}, \textit{GoBackNode} e \textit{RotateNode}.

Para calcular quanto tempo já está sendo executado um determinado estado, foi feito de forma análoga ao feito na máquina de estados. Assim, foi adicionado nos construtores das classes folhas o contador que era acrescido cada vez que era executado o comportamento desse estado. Assim, o tempo também seria esse contador vezes o tempo gasto em cada execução.

Ao entrar em um Behavior, ou seja, na execução da função \textit{enter}, eram setadas as velocidades que permaneceriam constantes durante aquele behavior, além de serem zerados os contadores. No caso específico do behavior \textit{Move In Spiral}, como sua velocidade era alterada em cada instante, essa atualização da velocidade foi feita na função \textit{execute}.

\begin{figure}[htbp]
\centerline{\includegraphics[scale=0.4]{behavior_tree.png}}
\caption{\textit{Behavior tree} do comportamento do Roomba.}
\label{behavior_tree}
\end{figure}

Já as funções \textit{execute}, além de realizarem o acréscimo do contador de execuções, também retornavam \textit{Success}, \textit{Failure} ou \textit{Running}, dependendo da situação que se encontrava o Roomba.

Uma breve descrição em alto nível das implementações foi apresentada nas subsessões a seguir.

\subsection{Roomba Behavior Tree}
\subsection{Behavior Move Forward}
\subsection{Behavior Move In Spiral}
\subsection{Behavior Go Back}
\subsection{Behavior Rotate}

\section{Resultados e Conclusões}
Before you begin to format your paper, first write and save the content as a 
separate text file. Complete all content and organizational editing before 
formatting. Please note sections \ref{AA}--\ref{SCM} below for more information on 
proofreading, spelling and grammar.

Keep your text and graphic files separate until after the text has been 
formatted and styled. Do not number text heads---{\LaTeX} will do that 
for you.

\begin{thebibliography}{00}
\bibitem{b1} M. Maximo, ``Roteiro: Laboratório 1 - Máquina de Estados Finita e Behavior Tree''. Instituto Tecnológico de Aeronáutica, Departamento de Computação. CT-213, 2019.
\end{thebibliography}

\end{document}
